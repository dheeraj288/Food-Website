<h2 class="text-4xl font-extrabold mb-8 text-gray-900">ðŸ›’ Your Cart</h2>

<% if @cart_items.any? %>
  <div class="space-y-6 pb-40">

    <% @cart_items.each do |item| %>
      <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-md hover:shadow-lg transition duration-300 flex flex-col sm:flex-row gap-5">

        <!-- Dish Image -->
        <div class="shrink-0">
          <%= image_tag item.menu_item.image_url, class: "h-24 w-24 rounded-xl object-cover border" %>
        </div>

        <!-- Info -->
        <div class="flex flex-col flex-grow justify-between">
          <div class="flex justify-between items-start">
            <div>
              <h3 class="text-lg font-semibold text-gray-800 mb-1"><%= item.menu_item.name %></h3>
              <p class="text-sm text-gray-500">â‚¹<%= item.menu_item.price %> Ã— <%= item.quantity %></p>
              <p class="text-sm font-medium text-green-600 mt-1">Total: â‚¹<%= item.menu_item.price * item.quantity %></p>
            </div>

            <!-- Remove Button -->
            <%= button_to cart_item_path(item), method: :delete, data: { confirm: "Remove this item?" },
              class: "text-red-500 hover:text-red-700 text-xl" do %>
              <i class="fas fa-trash-alt"></i>
            <% end %>
          </div>

          <!-- Quantity Stepper -->
          <div class="mt-4 flex items-center gap-3 w-fit bg-gray-100 px-3 py-1 rounded-full shadow-sm">
            <% if item.quantity > 0 %>
              <%= form_with model: item, url: cart_item_path(item), method: :patch, local: true do |f| %>
                <%= f.hidden_field :quantity, value: item.quantity - 1 %>
                <%= f.submit "-", class: "text-lg text-gray-600 font-bold px-2 hover:text-red-500" %>
              <% end %>
            <% else %>
              <span class="text-lg text-gray-300 px-2">â€“</span>
            <% end %>

            <span class="text-md font-semibold text-gray-700 px-2"><%= item.quantity %></span>

            <%= form_with model: item, url: cart_item_path(item), method: :patch, local: true do |f| %>
              <%= f.hidden_field :quantity, value: item.quantity + 1 %>
              <%= f.submit "+", class: "text-lg text-gray-600 font-bold px-2 hover:text-green-500" %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Subtotal -->
    <div class="mt-10 text-right">
      <p class="text-2xl font-semibold text-gray-800">
        Subtotal: â‚¹<%= @cart_items.sum { |item| item.menu_item.price * item.quantity } %>
      </p>
    </div>
  </div>

  <!-- ðŸ”’ Sticky Checkout Footer -->
  <div class="fixed bottom-0 left-0 w-full z-50 bg-white border-t border-gray-200 shadow-md px-4 py-4 flex justify-between items-center sm:px-10">
    <div class="text-gray-800 text-lg font-semibold">
      Total: â‚¹<%= @cart_items.sum { |item| item.menu_item.price * item.quantity } %>
    </div>
    <%= button_to "âœ… Proceed to Checkout", orders_path, method: :post,
          class: "bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-3 rounded-full shadow transition" %>
  </div>

<% else %>
  <!-- Empty Cart UI -->
  <div class="text-center mt-24">
    <p class="text-gray-500 text-xl mb-6">Your cart is empty ðŸ˜”</p>
    <%= link_to "ðŸ½ï¸ Browse Restaurants", (customer_user? ? customers_restaurants_path : restaurants_path),
          class: "bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-full shadow-md transition" %>
  </div>
<% end %>
