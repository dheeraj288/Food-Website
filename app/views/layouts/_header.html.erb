<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-5 py-4 flex justify-between items-center">

    <%= link_to root_path, class: "flex items-center gap-2 text-indigo-700 text-2xl font-bold hover:opacity-80 transition" do %>
      🍛 <span>BiharBhojan</span>
    <% end %>


    <!-- Mobile Toggle Button -->
    <button id="navToggle" class="md:hidden text-gray-700 text-2xl focus:outline-none">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Nav Links -->
    <nav id="mainNav" class="hidden md:flex flex-col md:flex-row md:items-center gap-3 md:gap-5 mt-4 md:mt-0 text-sm w-full md:w-auto">

      <% if user_signed_in? %>
        <!-- User Info -->
        <div class="text-gray-700 flex items-center gap-2">
          👋 <strong><%= current_user.email %></strong>
          <span class="px-2 py-0.5 rounded-full text-white text-xs font-semibold capitalize
            <%= admin_user? ? 'bg-blue-500' : restaurant_owner_user? ? 'bg-green-500' : 'bg-purple-500' %>">
            <%= current_user.role %>
          </span>
        </div>

        <!-- Role Dashboard -->
        <% if admin_user? %>
          <%= link_to "Admin Dashboard", admin_dashboard_path, class: "text-blue-600 hover:text-blue-800 transition" %>
        <% elsif restaurant_owner_user? %>
          <%= link_to "Owner Dashboard", owner_dashboard_path, class: "text-green-600 hover:text-green-800 transition" %>
        <% elsif customer_user? %>
          <%= link_to "Customer Dashboard", customer_dashboard_path, class: "text-purple-600 hover:text-purple-800 transition" %>
        <% end %>

        <!-- 🛒 Cart Button with Live Count -->
        <%= link_to cart_path,
            class: "relative inline-flex items-center text-gray-700 hover:text-indigo-600 transition",
            aria: { label: "View Cart" } do %>

          <span class="text-lg">🛒 Cart</span>

          <% total_quantity = current_user&.cart&.cart_items&.sum(:quantity) || 0 %>
          <span id="cart-count"
                class="absolute -top-2 -right-3 bg-red-600 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center font-bold transition-transform duration-300">
            <%= total_quantity %>
          </span>

        <% end %>

        <!-- Logout -->
        <%= link_to "Logout", destroy_user_session_path,
            data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
            class: "text-red-500 hover:text-red-700 transition" %>

      <% else %>
        <!-- Guest Links -->
        <%= link_to "Login", new_user_session_path, class: "text-blue-600 hover:text-blue-800 transition" %>
        <%= link_to "Sign Up", new_user_registration_path, class: "text-green-600 hover:text-green-800 transition" %>
      <% end %>

    </nav>
  </div>

  <!-- ✅ Mobile Nav Toggle Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggle = document.getElementById("navToggle");
      const nav = document.getElementById("mainNav");

      if (toggle && nav) {
        toggle.addEventListener("click", () => {
          nav.classList.toggle("hidden");
        });
      }
    });
  </script>
</header>
