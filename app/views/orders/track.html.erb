<!-- Header -->
<div class="max-w-4xl mx-auto px-4 py-8">
  <div class="bg-white shadow-xl rounded-lg p-6 border border-gray-200">
    <h2 class="text-3xl font-extrabold text-indigo-700 mb-6">
      🚚 Track Your Order #<%= @order.id %>
    </h2>

    <!-- Delivery Details -->
    <div class="space-y-4 text-gray-700 text-base">
      <div>
        <span class="font-semibold text-gray-900">📍 Delivery Address:</span>
        <span><%= @order.delivery_address %></span>
      </div>

      <div>
        <span class="font-semibold text-gray-900">👤 Delivery Boy:</span>
        <span><%= @delivery_boy&.name || "Not assigned yet" %></span>
      </div>

      <div>
        <span class="font-semibold text-gray-900">📞 Phone:</span>
        <span><%= @delivery_boy&.phone || "-" %></span>
      </div>
    </div>

    <!-- Map -->
    <div class="mt-6">
      <div class="rounded-lg overflow-hidden shadow border-2 border-indigo-300">
        <div id="map"
             class="w-full"
             style="height: 400px; transition: all 0.3s ease-in-out; border-radius: 8px;">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Leaflet CSS/JS -->
<%= stylesheet_link_tag "https://unpkg.com/leaflet@1.9.4/dist/leaflet.css", media: "all" %>
<%= javascript_include_tag "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" %>

<!-- Map Script -->
<script>
  document.addEventListener("turbo:load", function () {
    const deliveryLat = <%= @order.latitude || 0 %>;
    const deliveryLng = <%= @order.longitude || 0 %>;

    const map = L.map('map').setView([deliveryLat, deliveryLng], 13);

    // Base Map
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Delivery Address Marker
    const addressMarker = L.marker([deliveryLat, deliveryLng]).addTo(map);
    addressMarker.bindPopup('<b>Delivery Address</b>').openPopup();

    // Delivery Boy Marker
    <% if @delivery_boy && @delivery_boy.latitude && @delivery_boy.longitude %>
      const boyIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
        iconSize: [40, 40],
      });

      const deliveryBoyMarker = L.marker(
        [<%= @delivery_boy.latitude %>, <%= @delivery_boy.longitude %>],
        { icon: boyIcon }
      ).addTo(map);
      deliveryBoyMarker.bindPopup('<b>Delivery Boy</b>');
    <% end %>
  });
</script>
